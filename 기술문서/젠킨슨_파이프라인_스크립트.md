# 젠킨스 파이프라인 스크립트

```shell
pipeline {
    agent any
    
    environment {
        // 환경 변수를 정의합니다.
        GIT_REPO = '{GIT URL}'
        BRANCH = '{배포할 브랜치}'
    }    
    
    stages {
        stage('Checkout') {
            steps {
                git branch: '${env.BRANCH}', 
                credentialsId: '6201f8e5-d63b-4613-ad79-ba71ce29c989', 
                url: '${env.GIT_REPO}'
            }
        }
        
        stage('Gradle Build') {
            steps {
                bat '''
                    echo 'start bootJar'
                    ./gradlew clean bootJar
                '''
            }
            post{
                failure{
                    error 'Fail Build'
                }
            }
        }
        
        stage('Deploy {server ip}') {
            steps{
                sshPublisher(
                    publishers: [
                        sshPublisherDesc(
                            configName: '{}', 
                            transfers: [
                                sshTransfer(
                                    cleanRemote: false, 
                                    excludes: '', 
                                    execCommand: '''
                                        cd {path}
                                        base=${pwd}
                
                                        pid=$(ps -ef | grep "GMELoanApi-1.0.0-SNAPSHOT.jar" | grep -v "grep" | awk \'{print $2}\')
                
                                        if [[$pid == ""]]
                                        then
                                            echo "**********api is not running.**********"
                                        else
                                            kill -9 $pid
                                        echo "**********api end**********"
                                        fi
                
                                        nohup java -jar -Dspring.profiles.active=prod /home/wein/deploy/GMELoanApi-1.0.0-SNAPSHOT.jar 2>> /dev/null >> /dev/null & echo $!
                                        echo "**********api start**********"
                                        ''', 
                                        execTimeout: 120000, 
                                        flatten: false, 
                                        makeEmptyDirs: false, 
                                        noDefaultExcludes: false, 
                                        patternSeparator: '[, ]+', 
                                        remoteDirectory: '{path}', 
                                        remoteDirectorySDF: false, 
                                        removePrefix: 'build/libs', 
                                        sourceFiles: 'build/libs/GMELoanApi-1.0.0-SNAPSHOT.jar'
                                )
                            ], 
                            usePromotionTimestamp: false, 
                            useWorkspaceInPromotion: false, 
                            verbose: true
                        )
                    ]
                )                
            }
        }
    }
    
    post {
        always {
            // 언제나 실행되는 후속 작업을 정의합니다.
            echo 'Deploy is finished.'
        }
        success {
            // 파이프라인이 성공적으로 완료되었을 때 실행되는 후속 작업을 정의합니다.
            echo 'Deploy succeeded!'
        }
        failure {
            // 파이프라인이 실패했을 때 실행되는 후속 작업을 정의합니다.
            echo 'Deploy failed!'
        }
    }    
}
```

- pipeline syntax를 사용하여서 각 영역의 내용을 채워 넣어야 한다.